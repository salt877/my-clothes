<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
<meta charset="UTF-8">

<meta name="viewport"
	content="width=device-width, initial-scale=1, user-scalable=yes">
<meta name="description" content="" />
<meta name="author" content="" />
<title>MYQLO | カレンダー</title>
<link rel="icon" type="image/x-icon" href="../static/dist/assets/img/myqlo_favicon.jpg" th:href="@{/dist/assets/img/myqlo_favicon.jpg}" />
<!-- Font Awesome icons (free version)-->
<script src="https://use.fontawesome.com/releases/v5.13.0/js/all.js"
	crossorigin="anonymous"></script>
<!-- Google fonts-->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700"
	rel="stylesheet" type="text/css" />
<link
	href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic"
	rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />
<!-- Bootstrap core JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
<!-- Third party plugin JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
<!-- Core theme CSS (includes Bootstrap)-->
<link href="../static/dist/css/styles.css" rel="stylesheet" th:href="@{/dist/css/styles.css}"/>
<!-- FullCalender実装用 -->
<link href='../static/lib/main.css' rel='stylesheet' th:href="@{/lib/main.css}" />
<script src='../static/lib/main.js' th:src="@{/lib/main.js}"></script> 
<script src='../static/lib/locales/ja.js' th:src="@{/lib/locales/ja.js}"></script>
<script src='../static/lib/locales-all.js' th:src="@{/lib/locales-all.js}"></script>
<!-- 月別データ表示用 -->
<script src='../static/js/show_price.js' th:src="@{dist/js/show_price.js}"></script> 
<script>
	document.addEventListener('DOMContentLoaded', function() {
		var calendarEl = document.getElementById('calendar');
	    var calendar = new FullCalendar.Calendar(calendarEl, {
	    	navLinks: false,
	        locale: 'ja',
	        handleWindowResize: true, 
	        editable: true,
	        events: 
	        	{
	        	 	url : '/show/perchase/all' 
	        	},
	        dateClick: function(info) {
	        	
	        	 	var date = info.dateStr;
	        	 	
	        	 	var today = new Date();
	        	 	var year = today.getFullYear();
	        	 	var month = ("00" + (today.getMonth()+1)).slice(-2);
	        	 	var day = ("00" + today.getDate()).slice(-2);
	        	 	var todayFormat = year + '-' + month +　'-' + day;
	        	 	var maxDate = todayFormat;
	        	 	
	        	 	if(maxDate < date){
	        	 		return false;
	        	 	} 
	        	 	
	        			$.ajax({
	        				type:'GET',
	        				url: "/registerClothes/showRegisterClothesByCalendar",
	        				data : {
	        					perchaseDate : date
	        				},
	        				async: false	
	        			}).done(function(data){
	        				
	        				location.href = this.url;
	        				 	        		
	        			}).fail(function(XMLHttpRequest, textStatus, errorThrown){
	        				// HTTPリクエストのステータス情報 
	        				console.log("XMLHttpRequest : " + XMLHttpRequest.status);
	        				// エラー情報
	        				console.log("textStatus     : " + textStatus);
	        				// 例外情報
	        				console.log("errorThrown    : " + errorThrown.message);
	        			}).always(function(data){
	        			}); 
	        	    
	        	 },
	        eventClick: function(info) {
	        	
	        	var eventObj = info.event;
	        	
	        	if(eventObj.url){  	
	        	window.location.href = eventObj.url;
	        	info.jsEvent.preventDefault();
	        	} else {
	                alert("Clicked " + eventObj.title);
	              }	        	
	        }
	       
	       
	        	 
	      });
	    
	      calendar.render();
	    });
	
</script>
<style>
a {
	color: black;
}
body {
	/* margin: 40px 10px; */
	padding: 0;
	font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
	font-size: 14px;
}

#calendar {
	max-width: 1100px;
	margin: 0 auto;
}

 .fc-day-future a.fc-daygrid-day-number {
	pointer-events: none;
}  

.fc-day-other .fc-daygrid-event-harness{
	 display: none; 
}
.column {
    text-align: center;
    background-color: #EEEEEE;
}

</style>
</head>
<body>
	<!-- Navigation-->
	<div id="navArea">
		<nav class="navbar navbar-default" th:replace="header::pageheader"></nav>
	</div>
<section class="page-section bg-white">
	<div class="container" th:if="${dailyPerchaseDataList} != null">
		<div class="text-center" style="margin-top: 100px;">
			<h1 class="section-heading text-uppercase">MY CALENDAR</h1>
			<div class="section-subheading text-muted">MYQLOに登録した服を月ごとにチェック！</div>
			<br> <br>
		</div>

		<!-- 各月データテーブル -->
		<div class="text-center">
			<table class="table calendar">
				<thead>
					<tr class="column">
						<th id="total_price"><h6 class="month_total_price" th:utext="${month +'月の'+'<br>'+'購入金額合計'}">〇月の購入金額合計</h6></th>
						<th id="price_average"><h6 class="month_price_average" th:utext="${month +'月の'+'<br>'+'平均購入金額'}">〇月の平均購入金額</h6></th>
						<th id="item_quantity"><h6 class="month_item_quantity" th:utext="${month +'月の'+'<br>'+'購入アイテム数'}">〇月の購入アイテム数</h6></th>
					</tr>
					<tr>
						<td class="total_price" th:text="${#numbers.formatInteger(totalPrice, 1, 'COMMA')+'&nbsp;円'}">120,650 円</td>
						<td class="price_average" th:text="${#numbers.formatInteger(priceAverage, 1, 'COMMA')+'&nbsp;円'}">5,250 円</td>
						<td class="item_quantity" th:text="${itemQuantity} + '&nbsp;点'">22&nbsp;点</td>
					</tr>
				</thead>
			</table>
		</div>
		<br>
			
		<!-- カレンダー挿入位置 -->
		<div id='calendar'>
			<input type="hidden" id="loginUserId" th:value="${loginUserId}">
		</div>
		<br>

	</div>

</section>
	<!-- Footer-->
	<footer class="footer py-4" th:replace="footer::pagefooter"> </footer>
	

	<!-- Contact form JS-->
	<script src="../static/dist/assets/mail/jqBootstrapValidation.js" th:src="@{/dist/assets/mail/jqBootstrapValidation.js}"></script>
	<script src="../static/dist/assets/mail/contact_me.js" th:src="@{/dist/assets/mail/contact_me.js}"></script>
	<!-- Core theme JS-->
	<script src="../static/dist/js/scripts.js" th:src="@{/dist/js/scripts.js}"></script>
	<script src="../static/dist/js/hamburger_menu.js" th:src="@{/dist/js/hamburger_menu.js}"></script>
</body>
</html>